#!/bin/sh
set -e

echo "ğŸ¦€ pre-commit: gofmt..."
unformatted=$(gofmt -l .)
if [ -n "$unformatted" ]; then
  echo "âŒ Files not formatted:"
  echo "$unformatted"
  echo ""
  echo "Fix with: ./scripts/format.sh"
  echo "Or run:   gofmt -w ."
  echo ""
  exit 1
fi

echo "ğŸ¦€ pre-commit: go vet..."
go vet ./...

echo "ğŸ¦€ pre-commit: go test..."
go test ./... -count=1 -timeout=30s

echo "ğŸ¦€ pre-commit: docs.json validation..."
./scripts/check-docs-json.sh

echo "ğŸ¦€ PINCH! All checks passed."
